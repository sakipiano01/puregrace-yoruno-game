<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<title>Quiet Grace  ã¿ãŠã®1æ—¥ ã€œã‚ˆã‚‹ã®ã˜ã‹ã‚“ç·¨ã€œ</title>
<style>
* {
    box-sizing: border-box;
}

body {
    margin: 0;
    font-family: "Hiragino Mincho ProN", "Yu Mincho", serif;
    background: linear-gradient(160deg, #b8d4e8 0%, #a0c0d8 50%, #90b0cc 100%);
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    padding: 16px;
    transition: background 2s ease;
}

.game-container {
    width: 100%;
    max-width: 400px;
    background: rgba(255, 255, 255, 0.06);
    backdrop-filter: blur(12px);
    padding: 24px 20px;
    border-radius: 20px;
    border: 1px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4), inset 0 1px 0 rgba(255,255,255,0.1);
}

h1 {
    font-size: 15px;
    text-align: center;
    margin: 0 0 4px 0;
    color: rgba(255, 255, 255, 0.5);
    letter-spacing: 0.1em;
    font-weight: normal;
}

.subtitle {
    font-size: 11px;
    text-align: center;
    color: rgba(255, 255, 255, 0.3);
    letter-spacing: 0.15em;
    margin-bottom: 18px;
}

.scene-label {
    font-size: 11px;
    color: rgba(200, 180, 230, 0.6);
    text-align: center;
    margin-bottom: 10px;
    letter-spacing: 0.1em;
    min-height: 16px;
}

.scene-image {
    width: 65%;
    display: block;
    margin: 0 auto 16px auto;
    border-radius: 14px;
    opacity: 0;
    animation: fadeIn 1.5s ease forwards;
    box-shadow: 0 8px 24px rgba(0,0,0,0.3);
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.text {
    min-height: 90px;
    margin-bottom: 18px;
    line-height: 1.85;
    font-size: 14px;
    color: rgba(255, 255, 255, 0.82);
    opacity: 0;
    animation: fadeText 1.2s ease forwards;
    animation-delay: 0.4s;
    text-align: justify;
}

@keyframes fadeText {
    from { opacity: 0; transform: translateY(5px); }
    to { opacity: 1; transform: translateY(0); }
}

button {
    width: 100%;
    padding: 12px 14px;
    margin-bottom: 8px;
    border: 1px solid rgba(255, 255, 255, 0.15);
    border-radius: 10px;
    background: rgba(255, 255, 255, 0.07);
    font-size: 13px;
    color: rgba(255, 255, 255, 0.8);
    cursor: pointer;
    font-family: "Hiragino Mincho ProN", "Yu Mincho", serif;
    letter-spacing: 0.04em;
    line-height: 1.5;
    text-align: left;
    transition: background 0.2s ease, border-color 0.2s ease;
}

button:hover {
    background: rgba(255, 255, 255, 0.13);
    border-color: rgba(200, 180, 230, 0.4);
}

/* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ */
.status {
    margin-top: 18px;
}

.status-row {
    display: flex;
    align-items: center;
    margin-bottom: 7px;
    gap: 10px;
}

.status-label {
    width: 78px;
    font-size: 11px;
    color: rgba(255, 255, 255, 0.45);
    flex-shrink: 0;
    letter-spacing: 0.05em;
}

.status-bar-bg {
    flex: 1;
    height: 6px;
    background: rgba(255, 255, 255, 0.08);
    border-radius: 3px;
    overflow: hidden;
}

.status-bar-fill {
    height: 100%;
    border-radius: 3px;
    transition: width 0.6s ease;
}

.grace-fill {
    background: linear-gradient(to right, #c8a0c8, #e8b4d0);
}

.stress-fill {
    background: linear-gradient(to right, #8ab0a0, #a0c8b0);
}

/* ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ç”¨ */
.shop-message {
    font-size: 13px;
    color: rgba(255, 255, 255, 0.55);
    text-align: center;
    margin: 14px 0 10px 0;
    line-height: 1.8;
}

.shop-button {
    width: 100%;
    padding: 13px;
    margin-bottom: 8px;
    border: 1px solid rgba(200, 170, 220, 0.4);
    border-radius: 10px;
    background: rgba(180, 150, 200, 0.12);
    font-size: 13px;
    color: rgba(220, 200, 240, 0.9);
    cursor: pointer;
    letter-spacing: 0.08em;
    font-family: "Hiragino Mincho ProN", "Yu Mincho", serif;
    transition: background 0.2s ease;
}

.shop-button:hover {
    background: rgba(180, 150, 200, 0.22);
}

/* æ˜Ÿã®è£…é£¾ */
.stars {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    pointer-events: none;
    overflow: hidden;
    z-index: 0;
}

.star {
    position: absolute;
    width: 2px;
    height: 2px;
    background: white;
    border-radius: 50%;
    opacity: 0;
    animation: twinkle var(--duration) ease-in-out infinite;
    animation-delay: var(--delay);
}

@keyframes twinkle {
    0%, 100% { opacity: 0; }
    50% { opacity: var(--opacity); }
}

.game-container {
    position: relative;
    z-index: 1;
}
</style>
</head>
<body>

<!-- æ˜Ÿã®èƒŒæ™¯ -->
<div class="stars" id="stars"></div>

<div class="game-container">
    <h1>Quiet Grace</h1>
    <div class="subtitle">ã¿ãŠã®1æ—¥ ã€œã‚ˆã‚‹ã®ã˜ã‹ã‚“ç·¨ã€œ</div>
    <div class="scene-label" id="sceneLabel"></div>
    <div class="text" id="story"></div>
    <div id="choices"></div>
    <div class="status">
        <div class="status-row">
            <span class="status-label">ğŸŒ¸ ã‚„ã™ã‚‰ã</span>
            <div class="status-bar-bg"><div class="status-bar-fill grace-fill" id="graceBar" style="width:50%"></div></div>
        </div>
        <div class="status-row">
            <span class="status-label">ğŸƒ ã¤ã‹ã‚Œ</span>
            <div class="status-bar-bg"><div class="status-bar-fill stress-fill" id="stressBar" style="width:30%"></div></div>
        </div>
    </div>
</div>

<script>
// æ˜Ÿã‚’ç”Ÿæˆ
(function() {
    const starsEl = document.getElementById("stars");
    for (let i = 0; i < 60; i++) {
        const star = document.createElement("div");
        star.className = "star";
        star.style.left = Math.random() * 100 + "%";
        star.style.top = Math.random() * 100 + "%";
        star.style.setProperty("--duration", (2 + Math.random() * 4) + "s");
        star.style.setProperty("--delay", (Math.random() * 4) + "s");
        star.style.setProperty("--opacity", (0.2 + Math.random() * 0.6).toString());
        starsEl.appendChild(star);
    }
})();

// ã‚·ãƒ¼ãƒ³ã”ã¨ã®èƒŒæ™¯è‰²ï¼ˆãƒ©ã‚¤ãƒˆãƒ–ãƒ«ãƒ¼â†’å¤œã®æ·±ã„ç´«ã¸ï¼‰
const sceneBgs = [
    "linear-gradient(160deg, #b8d4e8 0%, #a0c0d8 50%, #90b0cc 100%)", // å¸°ã‚Šé“ï¼šãƒ©ã‚¤ãƒˆãƒ–ãƒ«ãƒ¼
    "linear-gradient(160deg, #8aaec8 0%, #7090b0 50%, #6080a0 100%)", // å¸°å®…ï¼šå°‘ã—æš—ã„ãƒ–ãƒ«ãƒ¼
    "linear-gradient(160deg, #607898 0%, #506888 50%, #405878 100%)", // ãŠé¢¨å‘‚ï¼šé’ã¿ãŒã‹ã£ãŸç´«
    "linear-gradient(160deg, #485070 0%, #3c4468 50%, #303860 100%)", // å¤œã®æ™‚é–“ï¼šæ·±ã„é’ç´«
    "linear-gradient(160deg, #362850 0%, #2e2448 50%, #26203e 100%)", // å¯ã‚‹å‰ï¼šæ¿ƒã„ç´«
    "linear-gradient(160deg, #2e2845 0%, #3d3260 50%, #302848 100%)", // ãŠã‚„ã™ã¿ï¼šæœ€ã‚‚æ·±ã„å¤œ
];

function updateBg(sceneIndex) {
    document.body.style.background = sceneBgs[Math.min(sceneIndex, sceneBgs.length - 1)];
}

// LoFi ãƒãƒ«ã‚¢ã‚¦ãƒˆ BGMï¼ˆWeb Audio APIï¼‰
let audioCtx = null;
let musicNodes = [];

function startMusic() {
    if (audioCtx) return;
    audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    const masterGain = audioCtx.createGain();
    masterGain.gain.setValueAtTime(0, audioCtx.currentTime);
    masterGain.gain.linearRampToValueAtTime(0.22, audioCtx.currentTime + 4);
    masterGain.connect(audioCtx.destination);

    // ãƒ­ãƒ¼ãƒ‘ã‚¹ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆLoFiã‚‰ã—ã„ã“ã‚‚ã£ãŸè³ªæ„Ÿï¼‰
    const lpf = audioCtx.createBiquadFilter();
    lpf.type = "lowpass";
    lpf.frequency.value = 1800;
    lpf.Q.value = 0.7;
    lpf.connect(masterGain);

    // ãƒ‡ã‚£ãƒ¬ã‚¤ï¼ˆæ¸©ã‹ã¿ã®ã‚ã‚‹æ®‹éŸ¿ï¼‰
    const delay = audioCtx.createDelay(0.5);
    delay.delayTime.value = 0.28;
    const delayGain = audioCtx.createGain();
    delayGain.gain.value = 0.25;
    delay.connect(delayGain);
    delayGain.connect(lpf);

    // ãƒ†ãƒ¼ãƒ—æ„Ÿã®ãŸã‚ã®ã‚ãšã‹ãªã‚³ãƒ¼ãƒ©ã‚¹ï¼ˆãƒ”ãƒƒãƒæºã‚Œï¼‰
    function makePad(freq, time, dur, vol) {
        [0, 0.005, -0.004].forEach((detune, i) => {
            const osc = audioCtx.createOscillator();
            const env = audioCtx.createGain();
            osc.type = i === 0 ? "triangle" : "sine";
            osc.frequency.value = freq * (1 + detune);
            env.gain.setValueAtTime(0, time);
            env.gain.linearRampToValueAtTime(vol * (i === 0 ? 1 : 0.4), time + 0.6);
            env.gain.linearRampToValueAtTime(vol * (i === 0 ? 0.85 : 0.3), time + dur - 0.8);
            env.gain.linearRampToValueAtTime(0, time + dur);
            osc.connect(env);
            env.connect(lpf);
            osc.start(time);
            osc.stop(time + dur);
            musicNodes.push(osc);
        });
    }

    // ãƒ”ã‚¢ãƒé¢¨ã®ãƒ¡ãƒ­ãƒ‡ã‚£ãƒãƒ¼ãƒˆ
    function playNote(freq, time, dur, vol) {
        const osc = audioCtx.createOscillator();
        const osc2 = audioCtx.createOscillator();
        const env = audioCtx.createGain();
        osc.type = "triangle";
        osc2.type = "sine";
        osc.frequency.value = freq;
        osc2.frequency.value = freq * 2;
        env.gain.setValueAtTime(0, time);
        env.gain.linearRampToValueAtTime(vol, time + 0.015);
        env.gain.exponentialRampToValueAtTime(vol * 0.5, time + 0.12);
        env.gain.exponentialRampToValueAtTime(0.001, time + dur);
        osc.connect(env); osc2.connect(env);
        env.connect(lpf);
        env.connect(delay);
        osc.start(time); osc2.start(time);
        osc.stop(time + dur); osc2.stop(time + dur);
        musicNodes.push(osc, osc2);
    }

    // LoFiãƒ“ãƒ¼ãƒˆï¼ˆæŸ”ã‚‰ã‹ã„ã‚­ãƒƒã‚¯ã¨ã‚¹ãƒã‚¢é¢¨ãƒã‚¤ã‚ºï¼‰
    function playKick(time) {
        const osc = audioCtx.createOscillator();
        const env = audioCtx.createGain();
        osc.type = "sine";
        osc.frequency.setValueAtTime(140, time);
        osc.frequency.exponentialRampToValueAtTime(40, time + 0.15);
        env.gain.setValueAtTime(0.5, time);
        env.gain.exponentialRampToValueAtTime(0.001, time + 0.25);
        osc.connect(env); env.connect(masterGain);
        osc.start(time); osc.stop(time + 0.3);
        musicNodes.push(osc);
    }

    function playSnare(time) {
        const buf = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.15, audioCtx.sampleRate);
        const data = buf.getChannelData(0);
        for (let i = 0; i < data.length; i++) data[i] = (Math.random() * 2 - 1) * (1 - i / data.length) * 0.5;
        const src = audioCtx.createBufferSource();
        const env = audioCtx.createGain();
        const hpf = audioCtx.createBiquadFilter();
        hpf.type = "highpass"; hpf.frequency.value = 600;
        src.buffer = buf;
        env.gain.setValueAtTime(0.18, time);
        env.gain.exponentialRampToValueAtTime(0.001, time + 0.14);
        src.connect(hpf); hpf.connect(env); env.connect(masterGain);
        src.start(time);
        musicNodes.push(src);
    }

    function playHihat(time, vol) {
        const buf = audioCtx.createBuffer(1, audioCtx.sampleRate * 0.05, audioCtx.sampleRate);
        const data = buf.getChannelData(0);
        for (let i = 0; i < data.length; i++) data[i] = (Math.random() * 2 - 1) * (1 - i / data.length) * vol;
        const src = audioCtx.createBufferSource();
        const hpf = audioCtx.createBiquadFilter();
        hpf.type = "highpass"; hpf.frequency.value = 5000;
        src.buffer = buf;
        src.connect(hpf); hpf.connect(masterGain);
        src.start(time);
        musicNodes.push(src);
    }

    // Fãƒ¡ã‚¸ãƒ£ãƒ¼7ç³»ã®LoFiã‚³ãƒ¼ãƒ‰é€²è¡Œ: Fmaj7 â†’ Am7 â†’ Dm7 â†’ Cmaj7
    // ãƒ†ãƒ³ãƒ: ç´„75BPMã€1æ‹ = 0.8ç§’ã€4æ‹ = 3.2ç§’ã€16æ‹ãƒ«ãƒ¼ãƒ— = 12.8ç§’
    const bpm = 75;
    const beat = 60 / bpm;

    // ã‚³ãƒ¼ãƒ‰æ§‹æˆéŸ³ï¼ˆHzï¼‰
    const chords = [
        // Fmaj7: F3 A3 C4 E4
        [174.61, 220.00, 261.63, 329.63],
        // Am7: A2 C3 E3 G3
        [110.00, 130.81, 164.81, 196.00],
        // Dm7: D3 F3 A3 C4
        [146.83, 174.61, 220.00, 261.63],
        // Cmaj7: C3 E3 G3 B3
        [130.81, 164.81, 196.00, 246.94],
    ];

    // ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼ˆãƒ«ãƒ¼ãƒˆéŸ³ï¼‰
    const bassFreqs = [87.31, 55.00, 73.42, 65.41]; // F2 A1 D2 C2

    // ãƒ¡ãƒ­ãƒ‡ã‚£ï¼ˆã‚†ã£ãŸã‚Šã¨ã—ãŸå³èˆˆé¢¨ï¼‰
    const melodyPattern = [
        [0,       329.63, beat * 1.8, 0.10],
        [beat*2,  261.63, beat * 1.5, 0.09],
        [beat*3.5,293.66, beat * 1.2, 0.08],
        [beat*5,  349.23, beat * 2.0, 0.10],
        [beat*7,  329.63, beat * 1.5, 0.09],
        [beat*8.5,293.66, beat * 1.0, 0.08],
        [beat*10, 261.63, beat * 2.5, 0.10],
        [beat*12.5,220.00,beat * 1.5, 0.09],
        [beat*14, 246.94, beat * 2.0, 0.11],
    ];

    const loopDuration = beat * 16;

    function scheduleLoop(startTime) {
        // ã‚³ãƒ¼ãƒ‰ãƒ‘ãƒƒãƒ‰ï¼ˆå„4æ‹ï¼‰
        for (let i = 0; i < 4; i++) {
            const t = startTime + i * beat * 4;
            chords[i].forEach((freq, j) => {
                makePad(freq, t + j * 0.04, beat * 4.2, 0.038);
            });
            // ãƒ™ãƒ¼ã‚¹
            makePad(bassFreqs[i], t, beat * 3.8, 0.06);
        }

        // ãƒ¡ãƒ­ãƒ‡ã‚£
        melodyPattern.forEach(([offset, freq, dur, vol]) => {
            playNote(freq, startTime + offset, dur, vol);
        });

        // ãƒ“ãƒ¼ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆã‚†ã£ãŸã‚ŠLoFiãƒ“ãƒ¼ãƒˆï¼‰
        for (let step = 0; step < 16; step++) {
            const t = startTime + step * beat;
            if (step % 8 === 0) playKick(t);
            if (step % 8 === 2) playKick(t + beat * 0.5);
            if (step % 4 === 2) playSnare(t);
            if (step % 2 === 0) playHihat(t, 0.12);
            if (step % 2 === 1) playHihat(t, 0.06);
        }

        // æ¬¡ã®ãƒ«ãƒ¼ãƒ—ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
        const nextLoop = startTime + loopDuration;
        const now = audioCtx.currentTime;
        const msDelay = (nextLoop - now - 0.5) * 1000;
        setTimeout(() => {
            if (audioCtx) scheduleLoop(audioCtx.currentTime + 0.5);
        }, Math.max(msDelay, 100));
    }

    scheduleLoop(audioCtx.currentTime + 0.5);
}

let grace = 50;
let stress = 30;
let scene = 0;

const story = document.getElementById("story");
const choices = document.getElementById("choices");
const sceneLabel = document.getElementById("sceneLabel");

const sceneLabels = [
    "ğŸš¶ å¸°ã‚Šé“",
    "ğŸ  å¸°å®…",
    "ğŸ› ãŠé¢¨å‘‚",
    "ğŸµ å¤œã®æ™‚é–“",
    "ğŸ“– å¯ã‚‹å‰",
    "ğŸŒ™ ãŠã‚„ã™ã¿",
];

function updateStatus() {
    document.getElementById("graceBar").style.width = Math.min(Math.max(grace, 0), 100) + "%";
    document.getElementById("stressBar").style.width = Math.min(Math.max(stress, 0), 100) + "%";
}

function nextScene() {
    story.style.animation = "none";
    story.offsetHeight;
    story.style.animation = null;
    choices.innerHTML = "";
    sceneLabel.innerHTML = sceneLabels[scene] || "";
    updateBg(scene);
    startMusic();

    if (scene === 0) {
        story.innerHTML =
            "<img src='images/mio_evening.png' class='scene-image'>" +
            "å†·ãŸã„å¤œé¢¨ãŒé ¬ã‚’ã‹ã™ã‚ã‚‹ã€‚ä»Šæ—¥ã‚‚ä¸€æ—¥ã€ã‚ˆããŒã‚“ã°ã£ãŸã€‚é§…ã®ãƒ›ãƒ¼ãƒ ã§é›»è»Šã‚’å¾…ã¡ãªãŒã‚‰ã€ä¸Šå¸ã®è¨€è‘‰ãŒã¾ã å°‘ã—é ­ã«æ®‹ã£ã¦ã„ã‚‹ã€‚å¤–ã®ç©ºæ°—ã‹ã‚‰ã€æ°—æŒã¡ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã®ã¯ã€æ€ã£ãŸã‚ˆã‚Šé›£ã—ã„ã€‚";
        createChoice("ğŸµ å¥½ããªéŸ³æ¥½ã‚’ã‹ã‘ã¦ã€ä»Šæ—¥ã®ã“ã¨ã‚’æ‰‹æ”¾ã™", 8, -6);
        createChoice("ğŸŒƒ å¼•ã£ã‹ã‹ã‚Šã‚’ãã®ã¾ã¾æ„Ÿã˜ãªãŒã‚‰ã€ã‚†ã£ãã‚Šæ­©ã", -3, 5);
    }
    else if (scene === 1) {
        story.innerHTML =
            "<img src='images/mio_home.png' class='scene-image'>" +
            "ç„é–¢ã‚’é–‹ã‘ã‚‹ã¨ã€é™ã‹ãªéƒ¨å±‹ã€‚å¤–ã®å†·ãŸã•ã‚’ã¾ã è‚Œã«æ„Ÿã˜ãªãŒã‚‰ã€ã¿ãŠã¯ç€æ›¿ãˆã‚‹ã“ã¨ã«ã—ãŸã€‚ãµã‚ã‚Šã¨ã‚„ã‚ã‚‰ã‹ã„éƒ¨å±‹ç€ã«è¢–ã‚’é€šã—ãŸç¬é–“ã€å°‘ã—ã ã‘å‘¼å¸ãŒæ·±ããªã£ãŸæ°—ãŒã—ãŸã€‚";
        createChoice("ğŸ«§ ã¾ãšãŠé¢¨å‘‚ã§ã—ã£ã‹ã‚Šæ¸©ã¾ã‚‹", 8, -6);
        createChoice("ğŸ›‹ å°‘ã—ã ã‘ä¼‘ã‚“ã§ã‹ã‚‰ã€ã‚†ã£ãã‚Šå‹•ã", 4, -2);
    }
    else if (scene === 2) {
        story.innerHTML =
            "<img src='images/mio_bath.png' class='scene-image'>" +
            "æ¹¯èˆ¹ã«ã¤ã‹ã‚ŠãªãŒã‚‰ã€ãµã¨æ€ã†ã€‚ã€Œã‚ãŸã—ã€ã¡ã‚ƒã‚“ã¨ã‚„ã‚Œã¦ã‚‹ã®ã‹ãªã€ã€‚æ­£è§£ã¯ãªã„å•ã„ãŒã€æ¹¯æ°—ã®ä¸­ã«æ¼‚ã†ã€‚èŠ¯ã¾ã§æ¸©ã¾ã‚‹ã¨ã€ä¸æ€è­°ã¨ç­”ãˆã‚’æ€¥ãŒãªãã¦ã‚‚ã„ã„æ°—ãŒã—ã¦ãã‚‹ã€‚";
        createChoice("ğŸŒ¿ è€ƒãˆã‚‹ã®ã‚’ã‚„ã‚ã¦ã€ãŸã æ¸©ã¾ã‚‹", 10, -8);
        createChoice("ğŸ’­ é™ã‹ã«ã€è‡ªåˆ†ã¨å‘ãåˆã£ã¦ã¿ã‚‹", 6, 2);
    }
    else if (scene === 3) {
        story.innerHTML =
            "<img src='images/mio_tea.png' class='scene-image'>" +
            "ãŠé¢¨å‘‚ä¸ŠãŒã‚Šã€æ€¥ã„ã§æœã‚’ç€ã‚‹ã€‚ã›ã£ã‹ãæ¸©ã¾ã£ãŸä½“ã‚’ã€å†·ã‚„ã—ãŸããªã„ã€‚å¥½ããªã‚«ãƒƒãƒ—ã«æ¸©ã‹ã„ã‚‚ã®ã‚’æ³¨ã„ã§ã€ã‚½ãƒ•ã‚¡ã«åº§ã‚‹ã€‚ã‚¹ãƒãƒ›ã®é€šçŸ¥ãŒ2ä»¶ã€‚ã“ã®é™ã‹ãªæ™‚é–“ã‚’ã€ä½•ã«ä½¿ãŠã†ã€‚";
        createChoice("ğŸ“µ é€šçŸ¥ã‚’é–‰ã˜ã¦ã€è‡ªåˆ†ã®æ™‚é–“ã«ã™ã‚‹", 10, -6);
        createChoice("ğŸ“± æ°—ã«ãªã£ã¦ã€ã¤ã„é–‹ã„ã¦ã—ã¾ã†", -5, 8);
    }
    else if (scene === 4) {
        story.innerHTML =
            "<img src='images/mio_book.png' class='scene-image'>" +
            "ã‚¹ã‚­ãƒ³ã‚±ã‚¢ã‚’ã—ãªãŒã‚‰ã€ä»Šæ—¥ä¸€æ—¥ã‚’æ€ã„è¿”ã™ã€‚ã†ã¾ãã„ã‹ãªã‹ã£ãŸã“ã¨ã‚‚ã‚ã£ãŸã€‚ã§ã‚‚èª°ã‹ã«ã€Œã‚ã‚ŠãŒã¨ã†ã€ã¨è¨€ãˆãŸç¬é–“ã‚‚ã‚ã£ãŸã€‚çœ ã‚‹å‰ã®ã“ã®æ™‚é–“ã ã‘ã¯ã€è‡ªåˆ†ã‚’ã„ãŸã‚ã‚‹ã“ã¨ã«ã—ã¦ã„ã‚‹ã€‚";
        createChoice("ğŸŒ¸ ä»Šæ—¥ã®ã¡ã„ã•ãªã‚ˆã‹ã£ãŸã“ã¨ã‚’ã€å¿ƒã«ç•™ã‚ã‚‹", 10, -5);
        createChoice("ğŸ“ æ˜æ—¥ã‚‚ã£ã¨ã†ã¾ãã‚„ã‚ã†ã€ã¨è‡ªåˆ†ã«è¨€ã„èã‹ã›ã‚‹", -4, 8);
    }
    else if (scene === 5) {
        story.innerHTML =
            "<img src='images/mio_sleep.png' class='scene-image'>" +
            "é›»æ°—ã‚’æ¶ˆã™ã€‚ã‚„ã‚ã‚‰ã‹ã„ç´ æãŒè‚Œã‚’åŒ…ã‚“ã§ã„ã‚‹ã€‚æš—é—‡ã®ä¸­ã§ã€ã¿ãŠã¯ãµã¨æ€ã†ã€‚ã€Œè‡ªåˆ†ã‚’å¤§åˆ‡ã«ã™ã‚‹ã£ã¦ã€ã©ã†ã„ã†ã“ã¨ã ã‚ã†ã€ã€‚ç­”ãˆã¯ã¾ã ã‚ã‹ã‚‰ãªã„ã‘ã‚Œã©ã€ä»Šå¤œã®é¸æŠãŒã€å°‘ã—ãšã¤æ•™ãˆã¦ãã‚Œã‚‹æ°—ãŒã—ãŸã€‚";
        createChoice("ğŸŒ™ ç­”ãˆã‚’å‡ºã•ãªã„ã¾ã¾ã€ç›®ã‚’é–‰ã˜ã‚‹", 10, -8);
        createChoice("âœ¨ æ˜æ—¥ã®è‡ªåˆ†ã«ã€ãã£ã¨å§”ã­ã‚‹", 8, -6);
    }
    else {
        ending();
    }

    updateStatus();
}

function createChoice(text, graceChange, stressChange) {
    const button = document.createElement("button");
    button.innerText = text;
    button.onclick = function() {
        grace += graceChange;
        stress += stressChange;
        scene++;
        nextScene();
    };
    choices.appendChild(button);
}

function ending() {
    sceneLabel.innerHTML = "âœ¨ ãŠã‚„ã™ã¿ãªã•ã„";

    let endingHTML = "";
    let shopMessage = "";

    if (grace >= 75 && stress <= 35) {
        endingHTML =
            "<img src='images/ending_goodnight.png' class='scene-image'>" +
            "ğŸŒ™ ã‚„ã•ã—ã„å¤œ<br><br>ã¿ãŠã¯ä»Šå¤œã€è‡ªåˆ†ã‚’ã¨ã¦ã‚‚å¤§åˆ‡ã«ã—ãŸã€‚<br>å¸ƒå›£ã®ä¸­ãŒã€ã‚„ã‚ã‚‰ã‹ãæ¸©ã‹ã„ã€‚<br>ãŠã‚„ã™ã¿ãªã•ã„ã€ã¿ãŠã€‚ã‚ˆãçœ ã‚Œã¾ã™ã‚ˆã†ã«ã€‚";
        shopMessage = "è‡ªåˆ†ã‚’ã‚„ã•ã—ãæ‰±ãˆã‚‹å¤œã«ã€‚Pure Grace ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’ã€‚";
    } else if (grace >= 55 && stress <= 55) {
        endingHTML =
            "<img src='images/ending_quiet.png' class='scene-image'>" +
            "ğŸŒ¿ é™ã‹ãªå¤œ<br><br>å°‘ã—æºã‚ŒãªãŒã‚‰ã‚‚ã€ã¿ãŠã¯è‡ªåˆ†ã®ãƒšãƒ¼ã‚¹ã‚’å®ˆã£ãŸã€‚<br>å®Œç’§ã˜ã‚ƒãªãã¦ã„ã„ã€‚ä»Šå¤œã®ã¿ãŠã¯ã€ã˜ã‚…ã†ã¶ã‚“ã ã€‚";
        shopMessage = "æºã‚ŒãªãŒã‚‰ã‚‚ã€è‡ªåˆ†ã§ã„ã‚‰ã‚Œã‚‹ã‚ãªãŸã¸ã€‚";
    } else {
        endingHTML =
            "<img src='images/ending_tired.png' class='scene-image'>" +
            "ğŸŒ§ ç–²ã‚ŒãŸå¤œ<br><br>ä»Šæ—¥ã¯å°‘ã—ã€è‡ªåˆ†ã‚ˆã‚Šå¤–ã‚’å„ªå…ˆã—ã¦ã—ã¾ã£ãŸã€‚<br>ã§ã‚‚æ˜æ—¥ãŒã‚ã‚‹ã€‚ä»Šå¤œã¯ãŸã ã€çœ ã‚Œã°ã„ã„ã€‚";
        shopMessage = "ç–²ã‚ŒãŸå¤œã®ã‚ãªãŸã«ã€ã»ã£ã¨ã§ãã‚‹æ™‚é–“ã‚’ã€‚";
    }

    story.innerHTML = endingHTML;
    choices.innerHTML =
        "<p class='shop-message'>" + shopMessage + "</p>" +
        "<button class='shop-button' onclick=\"window.open('https://puregrace.shopselect.net/items/all', '_blank')\">ä»Šå¤œã®ã¿ãŠã«å¯„ã‚Šæ·»ã†ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¦‹ã¦ã¿ã‚‹</button>" +
        "<button onclick='location.reload()'>ã‚‚ã†ä¸€åº¦ãƒ—ãƒ¬ã‚¤</button>";
}

nextScene();
</script>

</body>
</html>